
#### Part 5
Using the R on specifiction and estion of sample plan by simple random sampling, sistematic, stratification and to cluster. Propose: Present the statistic software R and sample select the estimation of differents sample plans, and how the simple random sampling, stratification sampling, cluster sampling and sistematic sampling. Preparation install R. Module1: Describe general concepts about statistic software R and package sampling on estimations by simples random sampling. Module2: Describe the package survey to estimation by the stratification sampling. Modulo3: Select samples by sistematic sampling and conglomerates with estimation to this plans on R. 
Modulo 1: Describe general concept about statistic software R and package sampling on estimation by simple random sampling.  Intro: when construct a search and drawing a complex sample, the data analysis on papel could be unavailable. Besides that, programming all the time th same formulas wastes so much time, when have to be apply in another part of process. Because of that, learn how to select sample and estimation for any sample plans by statistic software. In case we learn how to use R program inside the sample theory. In this module we know install R software and the principa characteristic which make it the best programming and the most versatile and widespread inside the academyc field and profissional fields. Using the library series inside the software to select simple random sample we do this estimation by sample plan. 
About software R: The R software is statistic and act as alternative by traditional statistic programming, as SPSS, SAS and Stata with open code language extensible. It means the software is open and can be used by users. And it's a extremely robust, simple to use, advanced and free. It's not exist demo version after this another version comletely are for pay, but it's all for free. E each person could just contribute with your own programming projects. That's really interesting because somebody on the other side could add somenthing inside the programming and you just using this code too. How interesting using R comed increase last years, and it's probabily you have to do something there or just implements by other person who available free using. Besides that, this environment is available on Windows, mac unix and linux. Do you know this software are always refresh and the userd could just download the last version. In the old days exists just classic R, original with a plataform more oldier, but nowadays you can use a interface more friendly and simple just to use it. In the real time, install class R and after that install a interface with better framworks. The operation of R is done in packages, named library. When you install R a lot of packages comes in the memory, and it's allow to use more than one interesting functions. It's done to R save space in memory and don't be to harvy. Other softwares, when you click to open all, everything is loading automatically, it's so harvy because the environment is hard to open with a lot slow time. The R works as a different, because you just install and download everything you gonna use. The number add just to figure indentify if it's the only space where you add something on programming. There you can click add the result appears. Figure 2 we have the inicial interface from RStudio. Note how we have more option than fig1. In this case, we have the 1 on local host where you do your programming, and the local will be use for backup. In case this program stops or the computer turn off, you'll lost everything if you were use R class, but RStudio is ok to save. That's a huge advantage. In 2 we can see easily how this data base and variables are using at this moment. Just click in some base and fast you see how much variables she had and what is the type of each variable.  Automatically , when created or read a file of data he'll add still add in that window. On 3 we got this window for execute commandas. That means this window is equal classic R. We can say the RStudio guarantee the R programming and more 3 window. All you need to execute will be done in this part of window. Finally we got the 4 on parts of exit with graphics results, help menu, intall and library charge and another things. Means, if you need some help to install one package you can go to 4 click on packages and intall how many packages you want. Just remember to install a package isn't sufficient to works, you need to loading. Al, the time you open and close the R it's mainting packages default (basics one). All them need to charged all the time. 
First access: when you open RStudio you can read a file of data, construct your base, install packages or just programming. You cans use a table, a simple graphic, one three dimensional, one scheme and infinit of options. Just using RStudio to do this analyses. To execute the programming sofatware, you can use a infinite options. We can uset the RStudio to do analyses. To execute the programming software you can just type it on window corresponde to the number of figure 2 after this type RUN in this window. Or you can just type directly the 3 and click enter. Let's see some examples for graphics of R could offer. Bacuse of that we can use a package instaal and loading R. That's a package graphics. Now, using the command you can type on software a italic to make different text and content. Let's start see demonstration of graphic package in 2 dimensions with the command demo. You can just copy and paste directly on programming or using: demo(graphics) After this type command below, press commanda enter repetition times. That's gonna show a lot of graphics of R could do it. /// This package are preview install and loading on R, so we don't need type your code. A lot of library need to been install and charged, as we seen in topics below. At this moment of install, depends of version R, could been showing the list of locals where you download packages. You can choose any local of list, but it's always indicate download in our city. As showing befora, inside R has a infinitive of packages where you can just using. To realixxe that sampling, we use the functions pre loading with R basically in two packages: Sampling and Survey. 
1. Sample Function: one of samples using is to select samples on R among sample(). This function is pre loading in memory R, so thats we don't need to install any package for this execute. To do this just using sample() who receive this vector as input and you say how many samples have to delete from this list. Let's say you are simulating plays and want to obtain from a common data 6 faces and desire obtain 10 results. As a result to play one time this common data is a number from 1 to 6, in this code is: sample(1:6, 10 replace=TRUE) It means, we are using th function sample() with three parameters.  It means we are using the function sample with three parameters. The first one refeers to the interval using the variance of 1 to 6, second one is the measure of sample which desires in this case of repetition and the replace said that retire is with or without replacement. At this way, we said the function sample is return 10 values, but all them inside had 1 to 6. So, we do this select by simple sample random method with replacement. You can use sample () to do the simple random sample withour replacement too. In this case, just substitue the TREU for FALSE on replace or just leave blank this part because the default of function is without replacement. Imagine you have done a buy from one store and receive one numbered coupon. the store wille one prixxe draw. probabily it'll do without replacement to the same person who won't gain two times. Knowing this the coupon prixxe using just insert sample() and obtain the result. The survey of this store analyse it available 9780 coupon. Just we can do it: sample(1:9780, 2, replace=FALSE) or just  sample(1:9780, 2) If rou rounded two way below, you have seen the result obtain different. How the value in return of function sample() is a number randomixxed, if you rounded this code a lot of times you'll obtain differents results each time. This behavior is correct for all cases, but, sometime you can desire obtain results repetition always when you execute this function. // Normally this happens just when you desire developer and test your code, or if you want the another person try reply yout results and obtain the same result. In this cases, it's commom specify the right value of input reference named seed.  if you offer a value for a seed, the sequence of random numbers will be definied for a knowing state. This happen because the R doesn't create numbers for truely randomic, but just numbers pseudorandom. A sequence pseudorandom is a set of numbers to, all pratichal effects appears random, because they are created by a algorithm. When you defined the input seed for a process pseudorandom, in R always return the same sequence pseudorandom. In R you use the function set.seed() to especific the input value for a seed. This argument for a set.seed() is for any integer value. let's use the equal seed, we can result the same result. 

set.seed(5)
sample(1:9780, 2, replace=FALSE)

## or just using:
set.seed(5)
sample(1:9780, 2)

the result of this programming had been offer the winners of both television from a coupon number 2255 and 6859, right? Remember what we are  seen using the RStudio, if you play R classic version, the result could be different. 

2. Sampling package: this package is another way to select samples, mainlywe used the sample plan more complex. It contains more functions and more internal option, but the most one goals is select sample using probabilistic sample. Obtain samples from R is easier, because the software treat this select just like a net subset form data. let's install this package and loading by:

install.packages("sampling")
library(sampling)

In this methos with replacement we need to used the function srswr(n,N). Just definied the sixxe of sample n and the populational sixx N. The function return with the vector with number times of unit decrease from this sample. First of all, we loading the package sample, after using these function. As example, we select a sample with sixxe 20 of population of sixxe 100. We always use the seed to ouor results aligned. We have:

set.seed(9)
s=srswr(20,100)
s

after run this commands, we have the result:

[1] 0 0 0 0 0 0 0 0 0 2 0 0 1 0 0 0 0 1 0 0 1 0 0 0 0 1 0 0 1 1 0 1 0 1 0 1 0 1 0 0 1 0
[43] 0 0 0 0 0 0 0 1 2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 2 0 0 0 0 0 0
[85] 0 0 0 0 1 0 0 0 0 1 0 0 0 0 0 0

This result had done by the seed equal for all, said the unit of population from 1 to 100 been select. This value is equal to 1 had done as select elements by just one time, how is with the replacement, the equal values is 2, means that unit are select by two times. To see this unit, we can just do it:


(1:100)[s!=0]

The select units is: 

[1] 10 13 18 21 26 29 30 32 34 36 38 41 50 51 78 89 94

We see who is select two times, we can use the follow command:

(1:100)[s==2]

We've three units select more one time:


[1] 10 51 78

For this simple random sample without replacemente we will use srswor(n,N). It's a abreviation for sample random sampling without replacement. We will do the same at the anterior case:

set.seed(10)
s=srswor(20,100)
(1:100) [s!=0]

the result we are found:
[1] 7 8 9 13 15 24 27 34 39 42 54 55 71 72 74 76 83 88 91 99

Estimation for simple random sample: we are using software R for estiomation for data applyes a simple random sample. It's important to do a review of expressions using the average estimation, total and variance for SRS. The R had a series of based for internally data loading in your memory. Other bases are adding at moment to loading one package. Let's insert this command to see all available bases:

data()

Using this base for the package sampling named MU284. This database is a real base since 1992. This data abouy 284 cities from Sweden. A lot of informations are raised , but let's see the information P85. This variable from a quantity of population ( a thousand units) for each 284 cities. To run this base and other variables we do this:

data(MU284)
fix(MU284)

Observe the command fix open another window to seen the base. But remember to close the window opened before proceed. If you don't close, R command will run next commands. In this population are composed by N=284 cities, you can observe this and view the quantity of lines for each row with:

N= nrow(MU284)
N

Let's select SRS without replacement composed by 80 cities with the sample function. We'll use this seed to obtain the same results:

n = 80
set.seed(8)
selec = sample(1:N, n)
sample = MU284[selec,]
sample

Let's do this total estimation for average, variances for this SRS. We'll do the "hand" of programming for each estimation below:

3. Estimation of population variables: 
3.1 Estimation of populacional average:

sum(sample$P85)/n

By this sample with 80 cities, we fot the estimation of populacional average for all cieties for almost 28688 people (remember of data are thousands) 

3.2 Estimation of variance from estimation for populacional average

(1-n/N)*var(sample$085)/n

The estimation of variance from estimation is average 6.26 peoples**2

3.3 Standard error from estimation from average populacional:

sqrt((1-n/N)*var(sample$P85)/n)

After take the square root with the function sqrt, we got the standard error with estimation average 2503 people. So, the error of average estimation was almost 2503 people (remember always the unit of thousando is given ate final result)

3.4 Estimation of populacional total:

N*sum(sample$P85)/n

The estimation of variance from this total populacional estimation is 505685,8 people**2.

3.5 Standard error from estimation from a populational Total

sqrt(Nˆ2*(1/n-1/N)*var(sample$P85))

After do this square root, we got the standard error from a total about 7111159 people. So, this estimation error is the total of 711115 people( remember always the unit of thousand of the final result). You can ask if all the time you need estimate something you have do programming a code. That's a question. The answer is depends. If you need to use something too specific, could be that answer is yes. Or need to search something on the internet about some package in R. But we say it doesn't exist something in this programming you didn't find it. For our luck exists one package named survey, for all this estimations without we need to remember this formulas fro a average or variance for example. We need to specify the parameter for a sample plan and we need some estimations. For this example we did:

install.packages("survey")
library(survey)
samples$N = N
SRS = svydesign(id = ˜ 0, data = sample, fpc = ~N)
SRS

The parameter id serves to say if have some cluster in data, how we don't leave, we did with 0 or 1, after this input with the sample and fpc factor.This factor named the factor for correction for finit population. nothing more than the total of population, in this case SRS. For that, before doing the svydesign, we add the new column for the total population. So, to do this estimation using the package survey, we do:

3.5.1 Estimation of populacional average (svymean)
svymean(˜P85, SRS)

3.5.2 Estimation of populacional total (svytotal)

svytotal(˜P85, SRS)

Compare this result obtain by the survey with the results where we have done the programming. Look hoje we can obtain the same result. In this way, we don't need none of type for programming, just input the data base, we said the sample plan we like to adopt this package if load all the stuff.

examples1: On bingo of 5 international travel will be done for all buyers of determine store in shopping mall. After one year of this they will be add in some place, the last coupon distributed were 45965. Suposed all this papers in the place were be select by RSR without replacement, so select the winners coupons if you are using the function sample or the package sampling(using this seed with tha value 7 for both cases.) 
Sample ={26067 457230088151716312 }  
sampling = { 457263121517126067 30088}

first thing to do is be cafreful with the seed equal 7 in rstudio. to do this select by SRS without replacemente with the function sample() just in case:
set.seed(7)
sample(45965,5)

or just

set.seed(7)
sample(45965,5, rep=F)

The result found will be the sample in values 26067 4572 30088 15171 6312

With this using with sampling package we will use the function srswor (sample random sampling without replacement)  with this run commands:

library(sampling)
set.seed(7)
s=srswor(5,45965)
(1:45965) [s!=0]

With this sample 4571 6312 15171 26067 30088

example2:
The r software presents a series of data bases intern in your memori. Other bases are adding at the moment it'll charge some packages. Read this lecture base named belgianmunicipalities. She is contains a series of informations of diverses cities from Belgium. One of this variables is salary for on person, this base named averageincome. Which is the estimative from average from this variable from you standard error to this sample sixxe 200? (use seed with the value 2): This estimative is the average income populacional is almost 24888 euros and the standard error is almost 211 euros. To load this package sampling we do this lecture base on data base and be clear about the sixxe of this populations N and the sixxe of this sample. So:
library(sampling)
data(belgianmunicipalities)
fix(belgianmunicipalities)
N=nrow(belgianmunicipalities)
n=200

Done this we need to select the sample sixxe 200 with the seed with the value 2:

set.seed(2)
selec = sample(1:N,n)
sample = belgianmunicipalities[selec,]

With this sample select, we will use the package survey to do this data estimation:

library(survey)
sample$N = N
SRS = svydesign(id=~ 1, data = sample, fpc = ~ N)
SRS

After estimate thie average, and the standard error:

svymean( ~ averageincome, SRS)

The result found was 24888 to the average almost 211 to the Standard error. 

Module 2:

Describe the package survey to estimation from stratification sampling: On module before we saw the principal related with the sampling. We say the software constructed by packages, which one the person could created your own sand share with the users in comunity. Now, let's explore this about survey package to estimation data. So, we saw the stratification sampling with software R and how to do correctly some type of allocation with samples exists. Survey package: before we saw the using of survey package to do this estimation for all variables. The survey was created in 2004 by Thomas lumley in Auckland University in Newxxeland. It contains a series of function with interns parameters availables with the analyse data by sampling complex. To use this package step by step: The first step is select the sample to use how we can be done the package sample. Step two  In this part is necessary specify the sample plan used among by function svydesign() Step three: with the industrial drwan constructed, we can use the functions survey to do this estimation consider with this plan. All this special functions starts with svy, for example, the svymean() and svytotal()
In case of stratification sampling SS the first thing to do is verified if have some base refeer to this strata. Remenber how is in SS all strata have to be select samples. To do this select we gonna use again the package sample. The ideia is just use the fuction library sampling to select all samples and the library survey to do this estimation. For this function we gonna use the parameter:

svydesign(id= ~, strata=~, data=, weights=, fpc=, method=) 

Let'se see this parameter to the function svydesign to package survey: 
ID indicated the unit of sampling to groupin in a cluster. As a sampling for conglomerates not use here, we just have to put ~1 or ~0 with the hightlighter on position 
strata:  argument to say the variable using to do this stratification
data: parameter refeer to the named data base of sample
weights: indicate the weight sampling for this unit. In this case, it'll influencer by the factor of strata sampleh and by the population sixxe (wh= nh/Nh) If it won't want using the weight, it can use the weight of probability from selection too, because the weight and the probability of selection will be inverse quantities. 
Think about this example: If you select 4 companies in total of 1000 for analysis. What is the probability fro select one of this companies? Honestly we do P=4/1000= 0,004 For each one of this companies the chance is 0,4% to be select. Now, think about on this question: how many companies for each one of these four companies have to be represents?
step by step: step one to select four of 1000, this 4 companies select have to reply for it or another company were not been select. That's a idea for weight, be more representative for whom aren't select just for all them who will. Step2: just dot it w=1000/4=250 it means, the iformation for each company will be weight from 250 because she need represent other it won't be selecting. In this example, the sampling weight for one of theses unit is 250. If you repair, it's related among 0,004 from probability of selection and the value 250 of weight. Step three: it's a universe from another. If we multiple 250*0,004 the result will be equal for 1. So, we got the probability from selection, just 1 divide for itself and we found the weight. Obtain these two magnitude you automatically can weight another. 
For function svydesign, you need option for informe how the probability for than weight. In case, just be blank, and the software will understand it had been do a stratification selection with weighting equals among the strata. 
fpc - argument using to do this correct because of the population have to be finit (finite population correction). It's a vector added base one sample which one register will add the total of population. If we are doing the stratification sample, the fpc will be the total of populational for each one of theses stratas. The important part of these using is, knowing the total value of population, it's possible reduce the variance when the substantial fraction from total population be sampling by sampling of data. After this the object in sample plan, we can just using svymean and svytotal to do the estimation fro the average and the total of these respective weight for standard error. 
Data base MU284: To construct this in the stratification sample plan after this do this estimation from this sample, used again the base MU284. How this plan is more complex, because involves the stratification let's check details for this data. On base contain all of 11 differents bases describe to 284 cities on Sweden. So the variable is: ID the identifier for each city with tha values among 1 and 284. P85 population from 1985 (in thousand conversion) P75 Population from 1975 (in thousands) RMT85 Tax revenue for town in 1985 (in thousand from swedish crowns) CS82 Numbers of politicians conservatives in town council  SS82 Numbers of politicians social democrats from the town council  S82 Number of total politicians in town council ME84 Number from employees in town in 1984 REV84 Values from real estate according to the assessment from 1984 (in millions from swedish crowns) REG Indicator from geographic region CL Indicator from a cluster (one cluster consits in group for town neighbohood)
To do this stratification sampling based on in that base, we gonna used the variable REG, it's a indicator from geographic region with the variable from stratification

Sampling stratification with R:
We are selecting the simple stratification sample without replacement of sixxe 80 with proportional alocation on sixxe of stratas. Let's understand the parts for each one of this sample plan. First, we will investigate on population how many strata exists. Well done this, we will do a proportional way of this sixxe for each strata for a allocation in sample, so this stratas will receive more sample than others stratas, it will receive small sample. In this way, we indicated the quantity of units will be select on for each strata by the methos SRS without replacement. For all, we do the stratification been realixxed, we can created our object from sample plan and do our estimations. First of all, to do this  SS to verified the quantity for strata we got in this register, it means our population. Remember, it need to do the register will be review to search some mistakes and possibles inconsistencies, and besides that, be constantly refresh. First, read all our data and discovery how many regions we have on this base, it means how much strata we need to created. To do this using againa the base MU287 from this way:
library(sampling)
data(MU284)
table(MU284$REG)

The result found after run this code below is:
table(MU284$REG)
1 
25
2 
48
3 
32
4 
38
5 
56
6 
41
7 
15
8 
29

Based on this result obtain in table 3, we have 8 regions possibles to do this stratification. And, we have the total for each region, for example 25 town of region, 1,28 town on region 2 , and successively. To find this weighting factor on strata Wh, we do Wh = Nh/N it means the proportion for each region is in relation for the total. Besides the R, we got:

prop.table(table(MU284$REG))

SO WE HAVE THIS WEIGHT IN RELATED WITH THE STRATA OF Total

prop.table(table(MU284$REG))
1 
0.08802817
2 
0.16901408
3 
0.11267606
4 
0.13380282
5 
0.19718310
6 
0.14436620
7 
0.05281690
8 
0.10211268

If you added all this values, you can find the value 1, because the total have to result 100%. How we can used this proportional allocation, this distribution maintains the fraction of sampling for each strata h equals the fraction populacional. It means, in this type of allocation, the preview sample is defied of sixxe n and distributed proportional for sixxe of strata. This allocation is given by nh= n Nh/N in R, just:

80*prop.table(table(MU284$REG))
1 
7.042254
2
13.521127
3
9.014085
4
10.704225
5
15.774648
6
11.549296
7
4.225352
8
8.169014

Based on this information we can calculted the sixxe of sample for each strata. It's important to rounded every sixxe from sample for integer superior more closer. // Be careful: in that way, you can obtain the minimum required for strata. It could happen because the sample sixxe in the end will be bigger than the planning previewer. Based on this the sixxe of sample for each strata will be 8, 14, 10, 11, 16, 12, 5 and 9 and the sixxe pass from 80 to 85 units. // To select this stratification sample, we used the function strata, it'll be a part of sampling package, in that way: 

set.seed(3) 
selec = strata(MU284, stratanames = "REG", sixe = 
c(8,14,10,11,16,12,5,9), method = "srswor")
selec

With this using seed, we find the same unit for select one. Just rounded selec, you can see the print in screen on select sample. Let's use the command to se the first 10 units from a sample. You can substitue the 10 below for each value:

head(selec,10)

Te result found is:

head(selec, 10)
REG ID_unit             Prob Stratum
1             4  0.3200000   1
1             5  0.3200000   1
1             7  0.3200000   1
1             8  0.3200000   1
1             10 0.3200000   1
1             11 0.3200000   1
1             12 0.3200000   1
1             21 0.3200000   1
2             27 0.2916667   2
2             30 0.2916667   2

Note the table above we got 4 columns, and the region REG; the Id_unit which identify the select; variable Prob the probability from selection; the stratum, equal a REG created by the same fucntion. Let's try understand how to obtain the probability to select to two stratas. The first on we got 25 companies on strata and how we want select just 8, just fo P1= 8/25 = 0,32. To the strata 2 we got P2= 14/48 = 0,2916667 and successively for others.To filter just one vraiable from one file, we use the symbol $ separate the name base from the name of variable. We, obtain just the probability from select on this way:

selec$Prob

We have the select unit, we need to use the data base original to create the new object with all variables for this sample unit. So, we do this:

 sample = getdata(MU284, selec)
 head(sample, 8)

The functiogetdata can complete the sample data with all information for this population MU284. The base named sample will contain all information possible just to select units. With this sample well stablished, we can construct the sample plan after realixxe the estiomation from data. To create the vector fpc with the population total. For example, the 8 first register are strata 1 which got 25 unit for population, we have to repet all the 25 on 8 row, and successively for all strata. In our vector will be done with the command repetition rep below:

fpc=rep(c(25,48,32,38,56,41,15,29),c(8,14,10,11,16,12,5,9))
fpc


To specify the sample plan we use the command svydesign, to put the variable from stratification, the probability for select and the fpc. So, we got:

library(survey)
plan_est = svydesign(id = ~1, strata = ~Stratum, probs = ~selec¢Prob, 
data = sample, fpc = ~fpc)

With the sample plan specify, we can use the function svymean to do this estimation, like this:

## Estimation average and the standard error for the variable P85 consider the sample plan stratified:

svymean(~P85, plan_est)

with this result above our estimation from average populational is 20.068 people and the standard error is almost 1272 people( remember this data are in thousand measure)

## Estimation from total and the standard error from a variable P85 consider the stratification sample plan:

svytotal(~P85, plan_est)

For this estimation from populacional total, we obtain 5700000 people with the standard error about 361100 people. In this way we can obtain estimation for the average in populacional total from our variable P85. You can repet all this process to another variable from this bank and compare the results. 

## Another way to obtain the same results: We need to do the estimation from the quantity from interested using the sample plan create by the function svydesign. One of this parameter informed were the probability to select. We can obtain the same result have been indicate on function which the sample weight instead the probabilty from selection. As we see the probability ad the weight are inverse quantitie, we can use this software and indicate the vector from weight at these moment to create the sample drawn. To do this, we can added the column on this base for sample the values of weight to this way:

sample$WEIGHT = 1/sample$Prob

What we're doing is acess the sample base and add the column named weight with the values 1 divide for respective probabilities from select for each row. Now, we can do this specifications from sample plan again. Let's named plan_est2 and after this we can estimate again our average and variances:

plan_est2 = svydesign(id = ~1, strata = ~Stratum, weights = ~WEIGHT,
data = sample, fpc= ~fpc)

Repair in this code below with the parameter of probabilities from selection was substitue the parameter weight. We do this estimation for the second plan, we got:

svymean(~P85, plan_est2)
svytotal(~P85, plan_est2)

Comparing the results and notic we found the same values. So, we can indicated the function for how much possibilities in this selection how the sample weight. In case we indicated nothing, we can assume the strata are the same sixxe.

##Result without FPC:

Let's do this estimation ignores the factor from correction in finit population. This factor is important, because indicated the sixxe of population in each strata. So, this software doesn't neet assumes the population is infinit, and the estimation error decrease.  In this case, just eliminate the parameter and do this again with this estimation, let's name this drwan with plan_est3. So we have:

plan_est3= svydesign(id = ~1, strata = ~Stratum, probs = ~selec$Prob, 
data = sample)

we can using this weight instead the probability for selection:

plan_est3 = svydesign(id = ~1, strata = ~Stratum, weights = ~WEIGHT,
data = sample)

The estimation done by:

svymean(~P85, plan_est3)
svytotal(~P85, plan_est3)

This table above with comparision among the estimation on plan 1 or 2 with the facto fpc and the plan 3 without factor:

Estimation/ Sample plan                      Plan 1 or 2 (with FPC)        Plan 3 (without FPC)
average (thousand)                            20068                          20.068
standard error of average (thousand)            12715                       15237
total(thousand)                                  56994                     5699.4
standard error of total (thousand)            3611                         432.73

Observe the interested on result at table 1, because to compare the same sample plan with the same sample using the fpc, can be possible to decrease the estimation error. We always need to find the same estimation for less error possibles. To comparin the estimation from the average or the total, the result are the same from another, but the standard error are the measure from fpc which decrease. So, always if you have this information, you can use this specifications for the sample plan.

## Estimation for each strata:  
## Estimation for each strata: 
The big advantage to use this SS is the possibility to do general estimation and particular for each strata. In this wat, we can follow the average and a specific total for any region, how it's the case from this example. For all this, we can use svyby and specify inside the parameter FUN the svymena, to estimate the average or the svytotal for estimate the total. We can use the follow commands:

svyby(~P85, by = ~Stratum, design = plan_est, FUN = svymean)

And the result presents by R for average is:

svyby( ~P85, by = ~stratum, design = plan_est, FUN = svymean)
Stratum  P85       se
1  1  4512500    5. 965668
2  2  19.57143   3.393806
3  3  1890000    1.963893
4  4  17.45455   1.751120
5  5  17.81250   3.007153
6  6  13.08333   1.409803
7  7  27.40000   6.343501
8  8  14.44444   6.214726

svyby(~P85, by = ~Stratum, design = plan_est, FUN = svytotal)

And the result presented by R were the total of:
svyby(~P85, by = ~Stratum, design = plan_est, FUN = svytotal)
Stratum  P85        se
1   1  1128.1250  149.14170
2   2  939.4286   162.90271
3   3  604.8000   62.84457
4   4  663.2727   66.54255
5   5  997.5000   168.40056
6   6  536.4167   57.80190
7   7  411.0000   95.15251
8   8  418.8889   180.227705

And the result presented by R is the total of:

svyby(~P85, by = ~Stratum, design = design = plan_est, FUN = svytotal)
Stratum  P85 se
1  1   1128.1250  149.14170
2 2 939.4286  162.90271
3 3 6048000 62.84457
4 4 6632727 6654255
5 5 9975000 168.40056
6 6 5364167  57.80190
7 7 4110000 95.15251
8 8 418.8889  180.22705

It's interested with this estimation by strata, because we can see the strata 1 of total estimation from total and the average of populacional are bigger than others. And it's possible about estimation of average and total we find the value from general values. To this total, just add for example, for each strata, we have, Y AE= 1.128,1250+939,4286 + 604,8000+663,2727+997,5000+ 536,4167 +411,0000+418,8889 = 5699,4   And this is the value exactly we found when we did the estimation from general total. 

Example1: About the base MU284, do the average from estimation and the standard error to the variable RMT85 - Municipal Tax Revenue in 1985 ( in thousand of sweden crowns) to stratification plan with the proportional allocation by sixxe of strata. Using the package sampling to select the sample and the package survey to do the estimations. Besides that, using the seed equal 3 and one sample by sixxe 50 on RStudio. In this way, which is correct: The estimation of average populacional is almost 175040 people, with the standard error of fence 21509. To load the package sampling, do this lecture of data base and be clear the sixxe of population N the sixxe of sample n, so the code:

library(sampling)
data(MU284)
N= nrow(MU284)
n=50

We've to do the proportional allocation with the sixxe for sample n=50, so:

table(MU284$REG)
50*prop.table(table(MU284$REG))

With this quantity obtain (remember to always rounded to upper) for each strata, we can select the stratification sample:

set.seed(3)
selec = strata(MU284, stratanames = "REG", sixxe = 
c(5,9,6,7,10,8,3,6), method = "srswor")
sample = getdata(MU284, selec)

We can indicated the parameter fpc with populacional total for each row base on the sample:
fpc=rep(c(25,48,32,38,56,41,15,29), c(5,9,6,7,10,8,3,6))

Now we can specify the sample plan:

library(survey)
plan_est = svydesign(id= ~1, strata = ~Stratum, probs = 
~selec$Prob, data = sample, fpc =~fpc)

Finally, we can estimate the average and the standard error:

svymean(~RMT85, plan_est)

The results found were 175.040 people for the average and the 21509 for the standard error. 

example2: By sampling package we can work with the database from towns in Belgium. The lecture from this base named belgianmunicipalities. She contains the series of informations of a lot town in Belgium. One of this variables is per capita income based on named averageincome. Which is the estimation from standard error average for the sample sixxe 300 for the region 1? Do this estimations and find the fpc and without fpc// the standard error average with the FPC is the 282.973 euror and without fpc is 406026 euros. First load the sampling package, do this read from data base and be clear with the sixxe of population N and the sixxe of sample n:

library(sampling)
data(belgianmunicipalities)
N= nrow(belgianmunicipalities)
n=300

We can do the proportional allocation of sixxe from sample n=300, so:

table(belgianmunicipalities$Province)
300*prop.table(table(belgianmunicipalities$Province))

With the quantity obtain ( remember to rounded for up) for each strata, we can select the stratification sample:

set.seed(5)
selec - strata(belgianmunicipalities, stratanames = 
"Province", sixxe = c(36,57,33,34,36,43,23,23,20), method
= "srswor")
sample = getdata(belgianmunicipalities, selec)

We can indicated this too with the parameter fpc with the populacional total for each line base on sample:

fpd=rep(c(70,111,64,69,84,44,44,38), c(36,57,33,34,36,43,23,23,20))

Now, we can specific the sample plan:

library(survey)
plan_est = svydesign(id = ~1, strata = ~Province, probs = ~selec$Prob, data = sample, fpc= ~fpc)

We can estimation the average for the Standard error for each strata:

svyby(~averageincome, by = ~Province, design = plan_est, FUN = svymean)

We want to find the strata 1, obtain the error 282 973. The result without fpc are fiven by:

plan_est2 = svydesign (id = ~1, strata = ~Province, probs 
= ~selec$Prob, data= sample)
svyby(~averageincome, by = ~Province, design = 
plan_est2, FUN = svymean)

The result for the strata 1 without fpc is 406026. We notes the standard error is bigger if it not informe the total of populacional among the parameters fpc.

## Module 3
Select the sample based on the sistematic sampling and conglomerates with the estimation for this plans in software R. Before this we saw the principal characteristic for survey package to do this specifications and the estimation of stratification sampling on software R. Now, let's explore the survey package now with the sampling conglomerates. Let's see the difference between the function because of using the sample divide from cluster. Besides thta, we need to do some comparision among sample plan and see the sistematic sampling to do this sample select. 

Sampling the conglomerates on R:
Another method using at moment of prepare the sample plan and the cluster sampling CS. The advantage of this plan said about the operational part, in sens of decrease the cost of this operation. Select the conglomerates and investigate the population inside, is in general, more cheap than other methods of sampling. The SC could be done for a lot stages, but we need to discuss the population been totally distributed inside some cluster. Remember the SC on stage 1 first to select the conglomerates and after this investigate all unit inside. Come back to the data base MU284, with the 284 town from Sweden. Diffently from cases befores, we gonna use the "CL" which delimits the cluster for each register from base. Let's select the sample for sample cluster without replacement in one stage, where the cluster are defined with the variables CL in our population in town. To do this comparision with the plans befores (stratification, for example), we gonna use the sample sixxe of sample n=80 towns. To do this explore table to search how much cluster in our population are divide:
library(sampling)
data(MU284)
data=MU284table(MU284$CL)

table(MU284$CL)
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 
5 5 5 5 5 5 8 5 8 5 6 8 5 7 6 5 8 5 5 5 5 6 5 5 5 5 
27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50
5 8 5 5 7 5 5 6 5 6 5 6 5 5 5 5 5 7 8 5 5 5 5 9

Note the figure with the population on town are divide in 50 cluster with the distributed so similar among they. To find the average general of towns inside the cluster just calculate:
M0= 284/50 = 5,68

So, the conglomerate got the average of 5,68 towns and if we want in this sampling had to be the sixxe of sample of fence 80 towns, we have to select almost 14 cluster because this happen 14*5,68=79,52 // We can use the sampling package with the function cluster to construct our sample. The function cluster produce the object with contain the select conglomerate, the identifier on towns belongings for one this cluster and the probabilities to select the same. Using the see with the value equals 5 we do on R:

set.seed(5)
ACS=cluster(MU284, clustername=c("CL"), sixxe=14, method=c("srswor"))

Note how we just get in the name on base, and the name of variable which define the cluster, the sixxe of conglomerate what we want select, the method to select this units, in case the simple random sample without replacemente (srswor). To see how this cluster seelcting, we can use again the command head() how:
head(ACS,10)

head(ACS,10)
CL  ID_unit Prob
2        9   0.28
2        10  0.28
2        7   0.28
2        8   0.28
2        6   0.28
3        13  0.28
3        12  0.28
3        14  0.28
3        11  0.28
3        15  0.28

The first 10 units select and the respective clusters. To this figure we got these respective identifications of units and the clusters. Repair the probabilities of selection is the same for all element, independent the cluster he is. Remember how we do this sample plan cluster on first stage, so, data the cluste had been select all the unit are been inestigatin. So, the important is select the cluster, and not the units inside there. So, the probabilitie is fix and given by unit from cluster which we are selecting divide in total exists, like this:

P(s)=14/50=0.28

Now, we have the cluster select we will cross this information with the original bank and obtain other variables refeer for this respectives units samples. Using again the function getdata:
ACSs= getdata(MU284,ACS)

To visualixxe this information for each units for cluster select, we can do this:
fix(ACSs)

Remember to close the window before continue. Another point is construct the fpc factor. In this way, we adding the vector with the total sixxe from cluster, in this case the value 50. So, we replicate 50 according to dimension object SCSs.

fpc2=rep(50,dim(ACSs)[1])
fpc2

Now we have to do this specifiction from our sample plan about the survey package and the function svydesign
library(survey)
PlanC=svydesign(id=~CL, data=SCSs, probs=~SCS$Prob, fpc=~fpc2)

Diffently of specifications before, now the id is not the value 0 or 1, it can receive exactly the variable cluster, base represents by CL. We can verified the definition of sample plan conglomerate construct by R, simply run run this code: 
PlanC

The result is given by:
PlanC1- level cluster Sampling design
with (14) Cluster
svydesign(id=~CL, data = SCSs, probs = ~SCS$Prob, fpc = ~fpc2)

Note how R describe perfectly the plan wich was constructed. We have the cluster plan in 1 stage for select the 14 cluster. Finally, the last step is to do the estimations to our variable from interested P85, So we got:

## Estimation of average and the standard error for the variable P85 consider the sample plan conglomerate in one stage:
svymean(~P85, PlanC)

With this result, our estimation average populacional is 28354 people and the standard error is fence 2500 people ( remember the data are thousand)

## Estimation from total and the standard error to the variable P85 consideer the sample plan conglomerate in 1 stage
svytotal(~P85, PlanC)

To this estimation from total populacional we obtain fence 8800000 people in standard error of fence 791400 people. In this way, we can obtain estimation from a average and the populacional total from our variable P85. You can repete all the process for other variable from bank and compare the result. 

## Other way to obtain the same result: The same way we do this SS we can obtain the same result change the variable from probabilities from this selection by weight variable. How the weight and the probabilities from select are inverses magnitude we can just given:
weight=1/SCS$Prob
SCS$Prob
weight

With this we construct this vector of weights and can use inside the function svydesign to do this specifiction from sample plan. So we got:

PlanC2=svydesign(id=~CL, data = SCSs, weights = weight, fpc=~fpc2)
svymean(~P85, PlanC2)
svytotal(~P85, PlanC2)

Compare the result, and loook how we have the same, to the average estimation for the total too

##Results without the FPC
Now, we can see the estimation ignores the factor of correction of population finit. In this case just eliminate the parameter and do this again with estimations. Let's named this like drawn planC_without_fpc So we got:

planC_without_fpc = svydesign(id= ~CL, data=ACSs, probs=~ACES$Prob)

We use this weight instead the probabilities for selection:

planC_without_fpc = svydesign(id=~CL, data=SCSs, weights = weight)

The estimation are done by:

svymean(˜P85, planC_without_fpc)
svytotal(~P85, planC_without_fpc)

This table above make the comparision between the estimation of plan 1 or 2 with the factor fpc of plan 3 without factor:
Estimation/sample plan   plan 1 or 2 (with FPC)    Plan 3(without FPC)
average (thousand)    28.354   28354
standard error average (thousand)   25005   294668
total (thousand)   8000  8000
standard error of total (thousand)  791.4   932.68

Observe the conclusion done by the result on table 2 are exactly equals the result in table 1, because if you compare the same sample plan you have the sample sample, the using of fpc make it could be possible increase the standard of estimation. If you compare this estimations of average or the total, the results coul be exaclty the same, but the standard error of measures the fpc increase. So, always when tou have this information using the especification in sample plan.

## Compare the estimation from sample plan: After obtain the results in estimation average, total and the respective standard error to this sample of sixxe of fence equals by sample plan differents we can reunited the obtain in table 3 above:

Estimation/sample plan SRS(with FPC)  SSS(with FPC)  SCS(with FPC)
average (thousand)    266888           20068          28354
standard error average (thousand)  25039 12715       25005
total(thousand)       81472                  56994        8000
standard error of total (thousand)  71112  361.1          791.4

Note the value of standard wrror of sampling stratification is inferir to other two methods. It's suggests the SS got the efficiency superior the SRS and the SCS. It's interessed this result by point of view of sample sixxe, because the stratifications can obtain more result more efficient with the sixxe of sample less than than SRS for example. And the SCS is a method, in general, less efficience to others, because the coust to do this sampling is more cheaper than other cases.

## Sampling sistematic on R:
In this type of sampling we select the point of start the population and we collect our elements about the interval of retire k. The elements have been availables on theae for example, one line or list, and it have be done randomic way. If we have to do this survey with data on a factory of lamps, we can take one lamp for a test for each 100 parts producted. We can define the sample by percentegae P% from population could be done in this part of sample. So, we can find the value k by:

k=1/P *100

After this draw the number r integer among 1 and k and the sample are composed by element in order r;r+k;r+2k;r+3k and successively. Let's check how we can do this selection on softwareR. One restaurant desire meet the best profile for his customers and have conditions to interview a fence 20% of the same. In average 30 customers enter the restaurant along for a day in a process one line surely ordened. How we can do this samples: step by step step1: to using this selection in R we used the function simple. just first we find the K:
set.seed(10)
(k <- round((1/20)*100))

step 2: With our interval established, we will draw the input r:
(r<- sample(seq(1,k,1),1))

step3: with the interval of selection and the input, we can indicated which will be the sample to be select in this case. It's possible to create function more complex which gonna do this automatically or just added r+nk in function below:
c(r,r+k, r+2*k, r+3*k, r+4*k, r+5*k)

In this case the unit will be a part of the sample: 3 8 13 18 23 28 

So, a real problem on SS occurs on estimation of measure on precision. According to Bolfarine (2005), in case of population to been in order random, doesn't exists more problems to estimates the variance by SS with the expressions of estimations on SRS. So, you can just use the same expressios or functions for estimation the R using for SRS.

Example1:
one search were ordered by a company show will be realixxed by the way sampling sistematic. By estimation of tickets sale 7900 people (numered by 1 to 7900 will be pass the line on show. One sample sistematic will be done with 10% of this total. Which is the numered for the 3 firsts one and the last 3 people interviewer, using the seed equal 5):  The three first is: 2, 12, 22. the last three is 7872, 7882, 7892. First we need to find the sixxe of sample will be select. By the question we got 10% of 7900 so 790 interview. So we find the interval by taken k like: 
set.seed(5)
(k<- round((1/10)*100))

The value of k is equal 10. Selecting randomixxed this input we have the value equal 2 from the command line:

(r<- sample(seq(1,k,1),1))

The last step is to fing the unit will be select so we do this:
c(r,r+k, r+2*k, r+787*k, r+788*k, r+787*k)
Remenver how the sequence input r, the last value is the sixxe of sample less 1, it means (n-1). So the value obtain is 2,12, 22, 7872, 7882, 7892 

exmaple 2:
Just do the lecture again from base belgianmunicipalities about the package sampling with the information contains from another town from Belgium. Let's continue working with the variable per capita income, on base named averageincome. Which is the estimation from average from the standard error for a sample for cluster with the sixxe 200? Do all estimation using the fpc (use the seed with the value 10) The average is 26794 euros and the standard error ir the average of 1146,4 euros. So, first we need to load the sampling package, and do the lecture of the data base and see how cluster exists in the population. so:
library(sampling)
data(belgianmunicipalities)
N=nrow(belgianmunicipalities)
N
table(belgianmunicipalities$Province)

We note the 9 clusters in this population, so divide the total N=589 by 9 we got the average 65,4 units for cluster. So, we need the sample sixxe 200 so we need to select 3 clusters. So we got:
set.seed(10)
SCS=cluster(belgianmunicipalities,clustername=c("Province"),size=3,method=c("srswor"))
SCSs=getdata(belgianmunicipalities,SCS)

We need to indicate our parameter fpc with the total of population for each line base on a sample:

fpc2=rep(9,dim(SCSs)[1])

So, we can specify the sample plan: 

library(survey)
Plano_SCS=svydesign(id=~Province,data=SCSs,probs=~SCS$Prob,fpc=~fpc2)

Now we can estimate the average and the standard error:
svymean(~averageincome,Plano_SCS)

The result obtain on R we got the estimation from 26974 for a average 1146,4 and the standard error of average suposed ona sampling cluster simple

For all this module we can understand the importance of using software R on sampling in analysis data base on sample. On software could be free and be feed by other library for around the worls, it'll increase all the time for a lot of users. First discuss some aspect about the programming how to do this installing from RStudio and other statistic packages to intro the statistic. We saw the using of package sampling and how to do this selection and estimations by the way of simple random sampling. In the second parte we understand the characteristic more specific about the library survey, commoly using for estimations on differente sample plans. Learning about how to do this stratification sampling on R ans how to use survey to do this estimations. Comparin some differentes ways to obtain this data we learn how to do this estimations specific by stratification. Finnaly we investigate the sampling conglomerate and sistematic on R. We did some comparison with other of estimations obtain by random simple, stratification and conglomerate. Be clear the efficience of stratification to be substantial on calculus of this measure precision. So we have som surely, at the end of this theme, how to learn about software R on Statistic and Data Science.

references:
BONAFINI, C. F. Probabilidade e Estatística. São Paulo: Pearson Education do Brasil, 2015.

COCHRAN, W. G. Sampling Techniques. 3rd. edition. New York: John Wiley & Sons, 1977.

LOHR, S. Sampling: Design and Analysis. 2nd. edition. USA: Duxbury Press, 2010.

MORETTIN, P. A.; BUSSAB, W. de O. Estatística Básica: Probabilidade e Inferência, Volume Único. São Paulo: Pearson Prentice Hall, 2010.

R-PROJECT. R Core Team. R: A language and environment for statistical computing. R Foundation for Statistical Computing, 2019, Vienna, Austria. Consultado em meio eletrônico em: 28 out. 2020.

SÄRNDAL, C. E.; SWENSSON, B.; WRETMAN, J. Model assisted survey sampling. New York: Springer-Verlag, 1992.


